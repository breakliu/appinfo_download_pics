<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>美团-团购美食电影酒店优惠</title>
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="http://wximg.gtimg.com/tmt/weixin-app-template/dist/css/style-templateA.css" />
    <style>
        .islider-dom {
            position: absolute;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        #iSlider {
            position: absolute;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .content {
            padding: 10%;
            height: 100%;
            width: 100%;
            -webkit-box-sizing: border-box;
        }

    </style>
</head>
<body>
<div id="iSlider"></div>

<div class="app__area">
    <img class="app__icon" src="http://pp.myapp.com/ma_icon/0/icon_11109_21278509_1434342134/96"/>
    <div class="app__name">美团-团购美食电影酒店优惠</div>
</div>


<div class="download" id="Jdl">
    <a class="ui-button" href="javascript:;" id="download"><i class="icon-loading" style="display:none"></i><span>立即下载</span></a>
    <p>
        <span style="margin-right: 15px;">大小:13M</span>
        <span><i class="icon__app"></i>应用宝认证</span>
    </p>
</div>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/zepto_modify.js"></script>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/islider.js"></script>
<script src="http://mp.weixin.qq.com/promotion/res/htmledition/appinfo/lib/wxdownload.js"></script>
<script src="http://pingjs.qq.com/tcss.ping.js"></script>
<script type="text/javascript">
    var CONFIG = {
        imgList: ["http://shp.qpic.cn/wxad/duc2TvpEgSQ9tI7wEN1pKlkKjnPA7O1OHJzqcrOSWhCtx6ibzZARbZTfvGHv8g290/0"]
    };
</script>
<script>

    // 放大元素,按照320x504定位,按比例scale
    function scaleEle(selector,position){
        var pageScale;
        var currentScale=screenWidth/screenHeight;
        var originScale=320/504;
        if(currentScale>originScale){
            pageScale=screenHeight/504;
        }else{
            pageScale=screenWidth/320;
        }
        $(selector).css({"-webkit-transform-origin":position,"transform-origin":position,"-webkit-transform":"scale("+pageScale+");","transform":"scale("+pageScale+");"});
    }

    var screenHeight = document.documentElement.clientHeight,
        screenWidth = document.documentElement.clientWidth;

    /*******************************************************************/
    var list = [];
    
    for(var i=0, l=CONFIG.imgList.length; i<l; i++){
        list.push({
            'content': '<div class="page page1" style="background-image: url('+CONFIG.imgList[i]+'); background-size: auto 504px; background-position: center center;"></div>'
        });
    }

    var islider = new iSlider({
        data: list,
        type: 'dom',
        dom: document.getElementById("iSlider"),
        fixPage: true,
        onslidechange: function(){
            resetHeight();
        }
    });

    if(list.length > 1){
        islider.addDot();
    }

    /*注意，不管开发用什么滑屏组件，这一段不能删，用于适配各种屏幕*/
    function resetHeight(){
        var h = document.documentElement.clientHeight,
            pages = document.querySelectorAll('.page');

        for(var i = 0, length = pages.length; i < length; i++){
            pages[i].style.backgroundSize = 'auto ' + h + 'px';
        }

        scaleEle("#Jdl","center");
        scaleEle(".islider-dot-wrap","center");
    }

    setTimeout(function(){
        resetHeight();
    }, 0);

    /*注意，不管开发用什么滑屏组件，这一段不能删，用于适配各种屏幕*/
    (function (doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function () {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 320) + 'px';
            };

        // Abort if browser does not support addEventListener
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
</script>
<script>
    var AppConfig = {
        pkgName: "com.sankuai.meituan",
        channelId: "000116083230393430373832",
        minVersion: "0",
        tag: "MEITUAN"
    };

    var buttonElement = document.getElementById('download');
    // 0-PENDING,1-DOWNLOADING,2-DOWNLOAD_SUCC,3-DOWNLOAD_FAIL,4-INSTALLED
    var stateHandle = function(state){
        if(state == 1){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载中');
            $(buttonElement).find('.icon-loading').show();
        }else if(state == 2){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载完成');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 3){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载失败');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 4){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('已安装');
            $(buttonElement).find('.icon-loading').hide();
        }
    };
    WxDownload.init({
        appConfig: AppConfig,
        buttonElement: buttonElement,
        stateHandle: stateHandle
    });

    pgvMain({virtualDomain: "p.weixin.qq.com"});
</script>
</body>
</html>
