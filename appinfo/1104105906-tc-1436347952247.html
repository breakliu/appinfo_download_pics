<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>奇迹暖暖</title>
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="http://wximg.gtimg.com/tmt/weixin-app-template/dist/css/style-templateC.css"/>
</head>
<body>
<div class="wraper">
    <div class="banner-wrap">
        <div class="banner" id="iSlider-wrapper"></div>
    </div>

    <div class="app__area">
        <div class="app__desc">
            <img class="app__img" src="http://pp.myapp.com/ma_icon/0/icon_11869213_21118857_1432040101/96"/>
            <div class="app__text">
                <div class="app__name">奇迹暖暖</div>
                <div class="app__other">
                    <span style="margin-right: 15px;">大小:206M</span>
                    <span><i class="icon__app"></i>应用宝认证</span>
                </div>
            </div>
        </div>
        <a class="ui-button" href="javascript:;" id="download"><i class="icon-loading" style="display:none"></i><span>下载<span></a>
    </div>
    <div class="mod-head">
        最新活动
    </div>
    <div class="mod-black-content">
        
            <p>○ 云端帝国“飘渺轩”夏日盛典，所有精美华服优惠出售！</p>
        
            <p>○ 每天登录领”璀璨星河“部件，连续登录7天获得整套！</p>
        
    </div>
    <div class="mod-head">
        详细介绍
    </div>
    <div class="mod-gray-content">
        <p>暖暖系列新作《奇迹暖暖》是一款全新的换装养成手游。数万服饰亿种搭配，百变风格1秒换装！首创搭衣PK全新玩法、高级定制服装玩法，小说式的剧情体验，邀您开启服饰搭配的奇迹梦想之旅！</p>
    </div>
</div>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/zepto_modify.js"></script>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/islider.js"></script>
<script src="http://mp.weixin.qq.com/promotion/res/htmledition/appinfo/lib/wxdownload.js"></script>
<script src="http://pingjs.qq.com/tcss.ping.js"></script>
<script type="text/javascript">
    var CONFIG = {
        imgList: ["http://shp.qpic.cn/wxad/duc2TvpEgSQEzdfx5oFjUuicJE5Xp2pHnqWHhRpFSnfQrgaw54tm1MMUww7WpSicCM/0"]
    };
</script>
<script>
    var list = [];

    for(var i=0, l=CONFIG.imgList.length; i<l; i++){
        list.push({
            content: CONFIG.imgList[i]
        });
    }

    var opts = {
        type: 'pic',
        data: list,
        dom: document.getElementById("iSlider-wrapper"),
        isLooping: true
    };
    var islider = new iSlider(opts);
    islider.addDot();

    /*****************************************/
    var $thumbList = $('#iSlider-wrapper'),
        curUrl = '',
        urlList = CONFIG.imgList,
        timer = null;

    //坑爹的用了 islder 这里不得不用事件代理，绑定回调还会执行两次，所以不得不特殊处理
    //开发哥如果有现成组件请改写
    $thumbList.on('tap', function(e){
        clearTimeout(timer);
        timer = setTimeout(function(){
            if(e.target.tagName === 'IMG'){
                curUrl = $(e.target).attr('src');
                weixinPreview();
            }
        }, 300);
    });

    function weixinPreview(){
        if (typeof WeixinJSBridge == "object" && typeof WeixinJSBridge.invoke == "function") {
            WeixinJSBridge.invoke("imagePreview",{
                "current": curUrl,
                "urls":urlList
            },function(res){
                alert(res.err_msg);
            });
        }
    }
</script>
<script>
    var AppConfig = {
        pkgName: "com.tencent.tmgp.qjnn",
        channelId: "000116083231323837343930",
        minVersion: "0",
        tag: "QJNN"
    };

    var buttonElement = document.getElementById('download');
    // 0-PENDING,1-DOWNLOADING,2-DOWNLOAD_SUCC,3-DOWNLOAD_FAIL,4-INSTALLED
    var stateHandle = function(state){
        if(state == 1){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载中');
            $(buttonElement).find('.icon-loading').show();
        }else if(state == 2){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载完成');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 3){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载失败');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 4){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('已安装');
            $(buttonElement).find('.icon-loading').hide();
        }
    };
    WxDownload.init({
        appConfig: AppConfig,
        buttonElement: buttonElement,
        stateHandle: stateHandle
    });

    pgvMain({virtualDomain: "p.weixin.qq.com"});
</script>
</body>
</html>
