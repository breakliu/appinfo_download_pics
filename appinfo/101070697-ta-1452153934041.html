<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>贝贝-母婴特卖</title>
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <script type="text/javascript">window._points=[+new Date];// 初始测速点</script>
    <link rel="stylesheet" type="text/css" href="http://wximg.gtimg.com/tmt/weixin-app-template/dist/css/style-templateA.css" />
    <style>
        .islider-dom {
            position: absolute;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        #iSlider {
            position: absolute;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .content {
            padding: 10%;
            height: 100%;
            width: 100%;
            -webkit-box-sizing: border-box;
        }

    </style>
    <script type="text/javascript">window._points[1]=+new Date;// css加载完成</script>
</head>
<body>
<div id="iSlider"></div>

<div class="app__area">
    <img class="app__icon" src="http://pp.myapp.com/ma_icon/0/icon_10598121_1451978595/256"/>
    <div id="app_name" class="app__name">贝贝-母婴特卖</div>
</div>


<div class="download" id="Jdl">
    <a class="ui-button" href="javascript:;" id="download"><i class="icon-loading" style="display:none"></i><span>立即下载</span></a>
    <p>
        <span style="margin-right: 15px;">大小:16M</span>
        <span><i class="icon__app"></i>应用宝认证</span>
    </p>
</div>
<script type="text/javascript">window._points[2]=+new Date;// dom加载完成</script>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/zepto_modify.js"></script>
<script src="http://wximg.gtimg.com/tmt/weixin-app-template/dist/js/islider.js"></script>
<script src="http://mp.weixin.qq.com/promotion/res/htmledition/appinfo/lib/wxdownload.v1.js"></script>
<script src="http://mp.weixin.qq.com/promotion/res/htmledition/appinfo/lib/speed.js"></script>
<script src="http://pingjs.qq.com/tcss.ping.js"></script>
<script type="text/javascript">
    var CONFIG = {
        imgList: ["http://shp.qpic.cn/wxad/duc2TvpEgSRrUXBF2uWfy6aaqQtRNvaZzCurgTDiaohAM5Gf6Aq1rZede181yv2pg/0"]
    };
</script>
<script>

    // 放大元素,按照320x504定位,按比例scale
    function scaleEle(selector,position){
        var pageScale;
        var currentScale=screenWidth/screenHeight;
        var originScale=320/504;
        if(currentScale>originScale){
            pageScale=screenHeight/504;
        }else{
            pageScale=screenWidth/320;
        }
        $(selector).css({"-webkit-transform-origin":position,"transform-origin":position,"-webkit-transform":"scale("+pageScale+");","transform":"scale("+pageScale+");"});
    }

    var screenHeight = document.documentElement.clientHeight,
        screenWidth = document.documentElement.clientWidth;

    /*******************************************************************/
    var list = [];
    
    for(var i=0, l=CONFIG.imgList.length; i<l; i++){
        var swipeRightHTML = '<div class="swipe-right"></div>'; // 左箭头划动提示
        list.push({
            'content': '<div class="page page1" style="background-image: url('+CONFIG.imgList[i]+'); background-size: auto 504px; background-position: center center;">' + (i == l - 1 ? '' : swipeRightHTML) + '</div>'
        });
    }

    var islider = new iSlider({
        data: list,
        type: 'dom',
        dom: document.getElementById("iSlider"),
        fixPage: true,
        onslidechange: function(){
            resetHeight();
        }
    });

    if(list.length > 1){
        islider.addDot();
    }

    /*注意，不管开发用什么滑屏组件，这一段不能删，用于适配各种屏幕*/
    function resetHeight(){
        var h = document.documentElement.clientHeight,
            pages = document.querySelectorAll('.page');

        for(var i = 0, length = pages.length; i < length; i++){
            pages[i].style.backgroundSize = 'auto ' + h + 'px';
        }

        scaleEle("#Jdl","center");
        scaleEle(".islider-dot-wrap","center");
    }

    setTimeout(function(){
        resetHeight();
    }, 0);

    /*注意，不管开发用什么滑屏组件，这一段不能删，用于适配各种屏幕*/
    (function (doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function () {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 320) + 'px';
            };

        // Abort if browser does not support addEventListener
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
</script>
<script>
    var AppConfig = {
        appName: "贝贝-母婴特卖",
        pkgName: "com.husor.beibei",
        channelId: "000116083231333936373637",
        minVersion: "0",
        tag: "beibeimuying",
        scheme: "beibeiapp://"
    };

    var appNameTxt = AppConfig.appName;
    var appNameMaxLen = 10;
    if (appNameTxt.length > appNameMaxLen) {
        $("#app_name").text(appNameTxt.replace(appNameTxt.substr(appNameMaxLen), "..."));
    }

    var buttonElement = document.getElementById('download');
    // 0-PENDING,1-DOWNLOADING,2-DOWNLOAD_SUCC,3-DOWNLOAD_FAIL,4-INSTALLED
    var stateHandle = function(state){
        if(state == 1){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载中，稍后提示安装');
            $(buttonElement).find('.icon-loading').show();
        }else if(state == 2){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载完成');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 3){
            $(buttonElement).addClass('ui-button_disabled').find('span').text('下载失败');
            $(buttonElement).find('.icon-loading').hide();
        }else if(state == 4){
            $(buttonElement).removeClass('ui-button_disabled').find('span').text('打开应用');
            $(buttonElement).find('.icon-loading').hide();
        }
    };

    var isAndroid = /Android/.test(navigator.userAgent);
    if(isAndroid){
        WxDownload.init({
            appConfig: AppConfig,
            buttonElement: buttonElement,
            stateHandle: stateHandle
        });
    }else{
        $(buttonElement).addClass('ui-button_disabled').find('span').text('请到AppStore下载贝贝客户端');
    }

    pgvMain({virtualDomain: "p.weixin.qq.com"});
</script>
<script type="text/javascript">window._points[3]=+new Date;// js加载完成</script>
<script type="text/javascript">
    setTimeout(function(){
        Huatuo.config('flagid', '1555-1-1');
        Huatuo.config('performid', '1555-1-2');
        Huatuo.add(_points);
        Huatuo.report();
    }, 1000);
</script>
<script type="text/javascript">
    var aid = 0;
    if(/aid=(\d+)/.test(location.href)){
        aid = parseInt(RegExp.$1) || 0;
    };
    var shareConfig = {
        title: '贝贝1.11',
        desc: '贝贝1.11，全民疯狂囤货，超级大牌1元包邮！',
        img_url: 'http://wximg.gtimg.com/wxp/assets/image/beibei-share.jpg',
        link: 'http://' + location.host + location.pathname + '?aid=' + aid
    };
    var afterWeixinJSBridgeReady = function () {
        WeixinJSBridge.on("menu:share:appmessage", function () {
            WeixinJSBridge.invoke("sendAppMessage", shareConfig, function (r) {});
        });
        WeixinJSBridge.on("menu:share:timeline", function () {
            var config = {
                title: '贝贝1.11，超级大牌1元包邮！',
                desc: shareConfig.desc,
                img_url: shareConfig.img_url,
                link: shareConfig.link
            };
            WeixinJSBridge.invoke("shareTimeline", config, function (r) {});
        });
    };

    if (typeof window.WeixinJSBridge == "undefined") {
        if (document.addEventListener) {
            document.addEventListener('WeixinJSBridgeReady', afterWeixinJSBridgeReady, false);
        } else if (document.attachEvent) {
            document.attachEvent('WeixinJSBridgeReady', afterWeixinJSBridgeReady);
            document.attachEvent('onWeixinJSBridgeReady', afterWeixinJSBridgeReady);
        }
    } else {
        afterWeixinJSBridgeReady();
    }
</script>
</body>
</html>
